/*******************************************************************************
 * dnAlienGunship generated by Eliot.UELib using UELib.CLI.
 * Eliot.UELib Â© 2009-2022 Eliot van Uytfanghe. All rights reserved.
 * http://eliotvu.com
 *
 * All rights belong to their respective owners.
 *******************************************************************************/
class dnAlienGunship extends dnGunship_Base
	collapsecategories;

var array<SDamageEffect> DamageEffects;
var array<SDamageEffect> SecondStageEffects;
var() int DamageThreshold1;
var() int DamageThreshold2;
var MaterialEx DamageOverlay;
var bool bPassedThreshold1;
var bool bPassedThreshold2;
var float TimeBetweenDamageEffects;
var float TimeBetweenDamageEffectsVariance;
var float DamageTaken;
var PlayerPawn EngagedPlayer;

event TakeDamage(Pawn Instigator, float Damage, Vector DamageOrigin, Vector DamageDirection, class<DamageType> DamageType, optional name HitBoneName, optional Vector DamageStart)
{
	local dnFriendFX_Spawners explosion;
	local SoftParticleSystem Smoke;
	local int i, j;
	local Vector gibDirection;
	local float HealthBefore;

	HealthBefore = Health;
	super(dnDecoration).TakeDamage(Instigator, Damage, DamageOrigin, DamageDirection, DamageType, HitBoneName, DamageStart);
	// End:0x45
	if(__NFUN_203__(Health, HealthBefore))
	{
		return;
	}
	__NFUN_209__(DamageTaken, __NFUN_199__(HealthBefore, Health));
	// End:0x79
	if(__NFUN_340__(PlayerPawn(Instigator), none))
	{
		EngagedPlayer = PlayerPawn(Instigator);
	}
	// End:0xC9
	if(__NFUN_201__(ThisFrameDamage.Damage, 0))
	{
		bDoOverlayEffect = true;
		OverlayMaterial = DamageOverlay;
		OverlayEffectAlpha = 0;
		FadeOverlayEffect(1, 0.2);
		__NFUN_607__(0.8, false, 'TurnOffDamageOverlay');
	}
	// End:0x223
	if(__NFUN_148__(__NFUN_200__(Health, float(DamageThreshold1)), __NFUN_145__(bPassedThreshold1)))
	{
		bPassedThreshold1 = true;
		explosion = __NFUN_615__(class'Barrel_Explosion_Spawner');
		// End:0x14F
		if(__NFUN_340__(explosion, none))
		{
			explosion.MountType = 2;
			explosion.__NFUN_591__(DrawScale);
			explosion.MountMeshItem = 'mount_thruster_left';
			explosion.__NFUN_635__(self);
		}
		explosion.ExecuteEffect(true);
		Smoke = __NFUN_615__(class'FlybyPlane_Damaged_Main');
		// End:0x1D6
		if(__NFUN_340__(Smoke, none))
		{
			Smoke.MountType = 2;
			Smoke.__NFUN_591__(0.5);
			Smoke.MountMeshItem = 'mount_thruster_left';
			Smoke.__NFUN_635__(self);
			Smoke.__NFUN_652__(__NFUN_265__(16384, 0, 0));
		}
		LeftThruster.__NFUN_590__(true);
		__NFUN_607__(__NFUN_226__(TimeBetweenDamageEffects, TimeBetweenDamageEffectsVariance), false, 'Damage1');
		__NFUN_607__(__NFUN_226__(TimeBetweenDamageEffects, TimeBetweenDamageEffectsVariance), false, 'Damage2');
		__NFUN_607__(__NFUN_226__(TimeBetweenDamageEffects, TimeBetweenDamageEffectsVariance), false, 'Damage3');
	}
	// End:0x5B3
	if(__NFUN_148__(__NFUN_148__(__NFUN_200__(Health, float(DamageThreshold2)), bPassedThreshold1), __NFUN_145__(bPassedThreshold2)))
	{
		bPassedThreshold2 = true;
		i = 0;
		J0x25A:

		// End:0x544 [Loop If]
		if(__NFUN_169__(i, string(SecondStageEffects)))
		{
			j = 0;
			J0x271:

			// End:0x53A [Loop If]
			if(__NFUN_169__(j, string(SecondStageEffects[i].SecondStageList)))
			{
				SecondStageEffects[i].EffectList[SecondStageEffects[i].SecondStageList[j].EffectListIndex].__NFUN_614__();
				SecondStageEffects[i].EffectList[SecondStageEffects[i].SecondStageList[j].EffectListIndex] = __NFUN_615__(SecondStageEffects[i].SecondStageList[j].SecondStageEffect, self,, __NFUN_238__(Location, __NFUN_263__(SecondStageEffects[i].DamageEffectOffset, Rotation)), __NFUN_269__(SecondStageEffects[i].DamageEffectRotation, Rotation));
				// End:0x4BB
				if(__NFUN_340__(SecondStageEffects[i].EffectList[SecondStageEffects[i].SecondStageList[j].EffectListIndex], none))
				{
					SecondStageEffects[i].EffectList[SecondStageEffects[i].SecondStageList[j].EffectListIndex].MountType = 2;
					SecondStageEffects[i].EffectList[SecondStageEffects[i].SecondStageList[j].EffectListIndex].MountMeshItem = 'Root';
					// End:0x44A
					if(__NFUN_206__(SecondStageEffects[i].DrawScale, 0))
					{
						SecondStageEffects[i].EffectList[SecondStageEffects[i].SecondStageList[j].EffectListIndex].__NFUN_591__(SecondStageEffects[i].DrawScale);
					}
					SecondStageEffects[i].EffectList[SecondStageEffects[i].SecondStageList[j].EffectListIndex].__NFUN_635__(self,,, true);
					SecondStageEffects[i].EffectList[SecondStageEffects[i].SecondStageList[j].EffectListIndex].DestroyOnDismount = true;
				}
				// End:0x530
				if(__NFUN_340__(dnFriendFX_Spawners(SecondStageEffects[i].EffectList[SecondStageEffects[i].SecondStageList[j].EffectListIndex]), none))
				{
					dnFriendFX_Spawners(SecondStageEffects[i].EffectList[SecondStageEffects[i].SecondStageList[j].EffectListIndex]).ExecuteEffect(true);
				}
				__NFUN_182__(j);
				// [Loop Continue]
				goto J0x271;
			}
			__NFUN_182__(i);
			// [Loop Continue]
			goto J0x25A;
		}
		Damage2();
		__NFUN_607__(__NFUN_226__(TimeBetweenDamageEffects, TimeBetweenDamageEffectsVariance), false, 'Damage1');
		__NFUN_607__(__NFUN_226__(TimeBetweenDamageEffects, TimeBetweenDamageEffectsVariance), false, 'Damage3');
		__NFUN_607__(__NFUN_226__(TimeBetweenDamageEffects, TimeBetweenDamageEffectsVariance), false, 'Damage4');
		__NFUN_607__(__NFUN_226__(TimeBetweenDamageEffects, TimeBetweenDamageEffectsVariance), false, 'Damage5');
		__NFUN_607__(__NFUN_226__(TimeBetweenDamageEffects, TimeBetweenDamageEffectsVariance), false, 'Damage6');
	}
	return;
}

function Destroyed()
{
	local float TestHealthCap;

	// End:0x1D
	if(__NFUN_200__(HealthCap, default.HealthCap))
	{
		TestHealthCap = HealthCap;		
	}
	else
	{
		TestHealthCap = default.HealthCap;
	}
	// End:0x61
	if(__NFUN_148__(__NFUN_203__(float(__NFUN_192__(DamageTaken)), TestHealthCap), __NFUN_340__(EngagedPlayer, none)))
	{
		DukePlayer(EngagedPlayer).UpdateAchievementCounter(22, 5);
	}
	super.Destroyed();
	return;
}

function TurnOffDamageOverlay()
{
	OverlayEffectAlpha = 1;
	FadeOverlayEffect(0, 0.4);
	return;
}

function CreateDamageEffect()
{
	local int Index, Count, i;
	local Actor Effect;

	Index = __NFUN_187__(12);
	J0x0A:

	// End:0x40 [Loop If]
	if(DamageEffects[Index].bOn)
	{
		Index = __NFUN_187__(12);
		__NFUN_184__(Count);
		// End:0x3D
		if(__NFUN_170__(Count, 48))
		{
			return;
		}
		// [Loop Continue]
		goto J0x0A;
	}
	DamageEffects[Index].bOn = true;
	i = 0;
	J0x5A:

	// End:0x1FE [Loop If]
	if(__NFUN_169__(i, string(DamageEffects[Index].EffectClassList)))
	{
		DamageEffects[Index].EffectList[i] = __NFUN_615__(DamageEffects[Index].EffectClassList[i], self,, __NFUN_238__(Location, __NFUN_263__(DamageEffects[Index].DamageEffectOffset, Rotation)), __NFUN_269__(DamageEffects[Index].DamageEffectRotation, Rotation));
		// End:0x1AB
		if(__NFUN_340__(DamageEffects[Index].EffectList[i], none))
		{
			DamageEffects[Index].EffectList[i].MountType = 0;
			// End:0x166
			if(__NFUN_206__(DamageEffects[Index].DrawScale, 0))
			{
				DamageEffects[Index].EffectList[i].__NFUN_591__(DamageEffects[Index].DrawScale);
			}
			DamageEffects[Index].EffectList[i].__NFUN_635__(self,,, true);
			DamageEffects[Index].EffectList[i].DestroyOnDismount = true;
		}
		// End:0x1F4
		if(__NFUN_340__(dnFriendFX_Spawners(DamageEffects[Index].EffectList[i]), none))
		{
			dnFriendFX_Spawners(DamageEffects[Index].EffectList[i]).ExecuteEffect(true);
		}
		__NFUN_182__(i);
		// [Loop Continue]
		goto J0x5A;
	}
	// End:0x238
	if(__NFUN_148__(DamageEffects[Index].bTwoStageEffect, __NFUN_145__(bPassedThreshold2)))
	{
		SecondStageEffects[SecondStageEffects.Add(1)] = DamageEffects[Index];
	}
	return;
}

simulated function bool CanHurtRadiusOther(Actor Other)
{
	// End:0x15
	if(Other.bIsPlayerPawn)
	{
		return false;
	}
	return super(Actor).CanHurtRadiusOther(Other);
	return;
}

function Damage1()
{
	CreateDamageEffect();
	return;
}

function Damage2()
{
	CreateDamageEffect();
	return;
}

function Damage3()
{
	CreateDamageEffect();
	return;
}

function Damage4()
{
	CreateDamageEffect();
	return;
}

function Damage5()
{
	CreateDamageEffect();
	return;
}

function Damage6()
{
	CreateDamageEffect();
	return;
}

event RegisterPrecacheComponents(PrecacheIndex PrecacheIndex)
{
	local int i;

	super.RegisterPrecacheComponents(PrecacheIndex);
	i = __NFUN_166__(string(DamageEffects), 1);
	J0x1A:

	// End:0x45 [Loop If]
	if(__NFUN_172__(i, 0))
	{
		RegisterDamageEffectForPrecache(PrecacheIndex, DamageEffects[i]);
		__NFUN_185__(i);
		// [Loop Continue]
		goto J0x1A;
	}
	i = __NFUN_166__(string(SecondStageEffects), 1);
	J0x54:

	// End:0x7F [Loop If]
	if(__NFUN_172__(i, 0))
	{
		RegisterDamageEffectForPrecache(PrecacheIndex, SecondStageEffects[i]);
		__NFUN_185__(i);
		// [Loop Continue]
		goto J0x54;
	}
	PrecacheIndex.__NFUN_1269__(DamageOverlay);
	PrecacheIndex.__NFUN_1266__(class'Barrel_Explosion_Spawner');
	PrecacheIndex.__NFUN_1266__(class'FlybyPlane_Damaged_Main');
	return;
}
