/*******************************************************************************
 * Industrial_Generic_Propanetank generated by Eliot.UELib using UELib.CLI.
 * Eliot.UELib Â© 2009-2022 Eliot van Uytfanghe. All rights reserved.
 * http://eliotvu.com
 *
 * All rights belong to their respective owners.
 *******************************************************************************/
class Industrial_Generic_Propanetank extends Industrial_Generic
	collapsecategories;

var() noexport float DelayedExplosionTime "After the first time we take damage, we'll force destory ourselves if the timer runs out before we take enough damage.";
var() noexport float DelayedExplosionVariance "Variance for the DelayedExplosionTime";
var array<SoftParticleSystem> BulletFires;
var class<SoftParticleSystem> BulletFireClass;
var int NumHits;
var float damageAbsorbed;

final function Explode()
{
	CriticalDamage();
	return;
}

simulated function Destroyed()
{
	__NFUN_608__('Explode');
	StopBulletFire();
	super(dnDecoration).Destroyed();
	RemoveMountedActorListActors(false, false);
	return;
}

simulated event Engine.Actor.ETraceFireHitResponse TraceFireHit(Actor SourceActor, class<TraceDamageType> TraceDamageType, Vector SourceTraceOrigin, Vector HitLocation, Vector HitNormal, name HitBoneName, bool bExtentTrace)
{
	local Rotator FireRotation;

	// End:0x0C
	if(MPRoundNotInProgress())
	{
		return 0;
	}
	FireRotation = Rotator(HitNormal);
	FireRotation.Roll = 0;
	FireRotation.Pitch = 0;
	StartFireAtBulletEntry(HitLocation, FireRotation);
	return super(KarmaActor).TraceFireHit(SourceActor, TraceDamageType, SourceTraceOrigin, HitLocation, HitNormal, HitBoneName, bExtentTrace);
	return;
}

event TakeDamage(Pawn Instigator, float Damage, Vector DamageOrigin, Vector DamageDirection, class<DamageType> DamageType, optional name HitBoneName, optional Vector DamageStart)
{
	local Vector SpawnLoc;
	local Rotator FireRotation;

	// End:0x0B
	if(MPRoundNotInProgress())
	{
		return;
	}
	super(dnDecoration).TakeDamage(Instigator, 0, DamageOrigin, DamageDirection, DamageType, HitBoneName, DamageStart);
	__NFUN_209__(damageAbsorbed, Damage);
	__NFUN_184__(NumHits);
	// End:0x168
	if(__NFUN_148__(__NFUN_200__(damageAbsorbed, Health), __NFUN_169__(NumHits, 4)))
	{
		// End:0x84
		if(__NFUN_173__(NumHits, 1))
		{
			__NFUN_607__(__NFUN_226__(DelayedExplosionTime, DelayedExplosionVariance), false, 'Explode');
		}
		// End:0x165
		if(__NFUN_173__(string(BulletFires), 0))
		{
			FireRotation.Pitch = 16384;
			FireRotation = __NFUN_269__(FireRotation, Rotation);
			SpawnLoc = __NFUN_238__(Location, __NFUN_241__(__NFUN_232__(0, 0, __NFUN_195__(0.75, CollisionHeight)), Rotation));
			StartFireAtBulletEntry(SpawnLoc, FireRotation);
			SpawnLoc = __NFUN_238__(Location, __NFUN_241__(__NFUN_232__(45, 0, __NFUN_195__(0.75, CollisionHeight)), Rotation));
			StartFireAtBulletEntry(SpawnLoc, FireRotation);
			SpawnLoc = __NFUN_238__(Location, __NFUN_241__(__NFUN_232__(-45, 0, __NFUN_195__(0.75, CollisionHeight)), Rotation));
			StartFireAtBulletEntry(SpawnLoc, FireRotation);
		}		
	}
	else
	{
		CriticalDamage();
	}
	return;
}

function StartFireAtBulletEntry(Vector BulletEntry, Rotator FireRotation)
{
	// End:0x64
	if(__NFUN_145__(DecorationIsDead()))
	{
		BulletFires[BulletFires.Add(1)] = __NFUN_615__(BulletFireClass,,, BulletEntry, FireRotation);
		BulletFires[__NFUN_166__(string(BulletFires), 1)].MountType = 0;
		BulletFires[__NFUN_166__(string(BulletFires), 1)].__NFUN_635__(self, false, false, true);
	}
	return;
}

function StopBulletFire()
{
	local int i;

	i = __NFUN_166__(string(BulletFires), 1);
	J0x0F:

	// End:0x4A [Loop If]
	if(__NFUN_172__(i, 0))
	{
		BulletFires[i].__NFUN_1054__();
		BulletFires[i].__NFUN_614__();
		__NFUN_185__(i);
		// [Loop Continue]
		goto J0x0F;
	}
	BulletFires.Remove(0, string(BulletFires));
	return;
}

event RegisterPrecacheComponents(PrecacheIndex PrecacheIndex)
{
	super(dnDecoration).RegisterPrecacheComponents(PrecacheIndex);
	PrecacheIndex.__NFUN_1266__(BulletFireClass);
	return;
}

defaultproperties
{
	DelayedExplosionTime=3
	DelayedExplosionVariance=0.5
	BulletFireClass='p_Decorations.Oil_Fire.OilFire_Main'
	DecoActivities_Default=/* Array type was not detected. */
	X=/* Unknown default property type! */
	
/* Exception thrown while deserializing Engine
System.ArgumentOutOfRangeException: Length cannot be less than zero.
Parameter name: length
   at System.String.Substring(Int32 startIndex, Int32 length)
   at UELib.Core.UDefaultProperty.DeserializeDefaultPropertyValue(PropertyType type, DeserializeFlags& deserializeFlags) in E:\SteamLibrary\steamapps\common\DukeNukem\Tools\UnrealscriptDecompiler\Core\Classes\UDefaultProperty.cs:line 578 */
}